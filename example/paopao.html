<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>泡泡</title>
	<style type="text/css">
		body {
			background: #262626;
		}

		canvas {
			display: block;
			margin: 100px auto;
		}
	</style>
</head>

<body>
	<canvas id="canvas" width="600" height="600"></canvas>
	<script type="text/javascript">
		const canvas = document.getElementById("canvas"),
			ctx = canvas.getContext("2d"),
			circleArr = [],
			fl = 500,
			R = 30,
			width = canvas.width,
			height = canvas.height,
			center = {
				x: width / 2,
				y: height / 2
			},
			random = () => ((Math.random() > 0.5 ? 1 : -1) * Math.random() + 0.5);
		let index = 0;

		//圆形类
		class Circle {
			constructor(x, y, r, color) {
				this.x = x;
				this.y = y;
				this.r = r;
				this.z = 0;
				this.index = index++;
				// 颜色的取值范围
				this.color = "rgba(" + (parseInt(Math.random() * 240) + 9) + "," + (parseInt(Math.random() * 220) + 18) + ",203,0.85)";

				//往数组中push自己
				circleArr.push(this);
			}

			//绘制
			print() {
				//新建一条路径
				ctx.beginPath();
				//创建一个圆
				ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2, true);
				//设置样式颜色
				ctx.fillStyle = this.color;
				//通过填充路径的内容区域生成实心的图形
				ctx.fill();
			}

			//更新
			update() {
				this.z += 0.4
				let scale = fl / (fl + this.z);
				this.x = center.x + scale * (this.x - center.x)
				this.y = center.y + scale * (this.y - center.y)
				this.r = this.r * scale;
				if (this.index == 1) console.log("scale:", scale.toFixed(2) * 1, "r:", this.r.toFixed(2) * 1, " z:", this.z.toFixed(2) * 1)
				if (this.r < 0.1) {
					for (let i = 0; i < circleArr.length; i++) {
						if (circleArr[i] === this) {
							circleArr.splice(i, 1);
						};
					}
					return false;
				}
				return true;
			}
		}

		for (let i = 0; i < 500; i++) {
			if (i == 0) new Circle(random() * width, random() * height, R, "orange");
			else
				setTimeout(() => {
					new Circle(random() * width, random() * height, R, "orange");
				}, i * 50)
		}


		//更新和绘制
		const update = () => {
			ctx.clearRect(0, 0, 1000, 600)

			if (circleArr.length > 0) {
				for (let i = 0; i < circleArr.length; i++) {
					if (circleArr[i]) circleArr[i].update() && circleArr[i].print();
				};
				requestAnimationFrame(update)
			} else {
				console.log("animation end")
			}

		}
		requestAnimationFrame(update)

	</script>
</body>

</html>